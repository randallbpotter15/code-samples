"use strict";function InputFileIsCSV(e){console.log(e);var i=mime.lookup(e),n=!1;if("text/csv"!==i)throw new TypeError("Wrong file type.",e,10);return n=!0}function digestCSV(e){if(InputFileIsCSV(e)!==!0)throw new TypeError("Wrong file type.",e,10);console.log("digestCSV: file: "+e);var i=require("csvtojson").Converter,n=new i({trim:!0,workerNum:2,flatKeys:!0,checkType:!0});require("fs").createReadStream(e).pipe(n),n.on("end_parsed",function(e){function i(e){var i,n=[],t=1;e.reduce(function(e,r){e[r["contact id"]]||(e[r["contact id"]]={score:0,"contact id":r["contact id"],quartile:""},n.push(e[r["contact id"]]));var a=r.event;return"web"==a&&(t=1),"email"==a&&(t=1.2),"social"==a&&(t=1.5),t="webinar"==a?2:1,parseFloat(e[r["contact id"]].score+=r.score*t,10).toFixed(2),i=e[r["contact id"]].score,e[r["contact id"]].quartile=o,finalResult=e,e},{})}console.log("end parse"),i(e);var n,t=[];for(var r in finalResult)t.push(finalResult[r].score),n=Math.max.apply(this,t)/100;for(var r in finalResult){finalResult[r].score=Math.round(finalResult[r].score/n);var o="unassigned",a=finalResult[r].score;a>=75&&100>=a&&(o="Platinum"),a>=50&&74>=a&&(o="Gold"),a>=25&&49>=a&&(o="Silver"),25>a&&(o="Bronze"),finalResult[r].quartile=o}return console.log(finalResult),finalResult})}var mime=require("mime"),scoringengine=require("commander"),fileName="";scoringengine.command("exec <cmd>").alias("ex").description("execute the given remote cmd").option("-f, --file <file>","Which file to use").action(function(e,i){var n=i.file;switch(e){case"digestCSV":fileName=n,digestCSV(fileName);break;default:console.log("No recognized command specified.")}}),scoringengine.parse(process.argv),module.exports.InputFileIsCSV=InputFileIsCSV;var finalResult={};